# Сервис для работы с направленным ациклическим графом (DAG)

## Общая информация

В проекте реализовано REST API для работы с ориентированными ациклическими графами. Основной функционал:

* Создание ориентированных графов
* Получение графа в виде списка узлов и рёбер
* Получение графа в виде списка смежности
* Получение графа в видео обратного списка смежности
* Удаление узла с каскадным удалением рёбер

## Принятые решения

**Ограничения на уровне БД**

  * В `NodeModel` используется `UniqueConstraint` на `(graph_id, name)` для обеспечения уникальности имён.
  * В `EdgeModel` используются `UniqueConstraint` на `(graph_id, source_id, target_id)` и `(graph_id, target_id, source_id)`, чтобы исключить дубликаты и двунаправленные рёбера.

## Развертывание сервиса 

### Зависимости
Для развертывания вам понадобится:
* **Docker** версии 19.03.0+
* **Docker Compose** версии 1.27.0+ (в docker CLI встроен Docker Compose V2, можно писать `docker compose`, без дефиса)
* Доступ к docker образам `python:3.12`, `postgres:15`

### Переменные окружения

| Переменная         | Значение по умолчанию      | Описание            |
| ------------------ | -------------------------- | ------------------- |
| POSTGRES\_USER     | `postgres`                 | Имя пользователя БД |
| POSTGRES\_PASSWORD | `postgres`                 | Пароль БД           |
| DB\_HOST           | `localhost`                | Адрес сервера БД    |
| DB\_PORT           | `5432`                     | Порт сервера БД     |
| DB\_PATH           | `/var/lib/postgresql/data` | Путь к хранилищу БД |

### Установка

1. Клонировать репозиторий:

   ```bash
   git clone <repo-url>
   cd <repo-dir>
   ```
2. Запустить развертывание контейнеров:

   ```bash
   docker-compose up -d 
   ```

3. Инициализация базы данных проходит автоматически при запуске.

API будет доступен по адресу: `http://localhost:8080`

### Документация API
Можно просмотреть автоматичсеки сгенерированную докуменатцию API сервиса:
* Swagger UI: `http://localhost:8080/docs`

## Запуск тестов

1. Установите зависимости для тестов:

   ```bash
   pip install -r requirements.txt
   ```
2. Запустите тесты с помощью pytest:

   ```bash
   pytest
   ```

---

## Технический стек

* Язык: Python 3.11

* Фреймворк: FastAPI

* База данных: PostgreSQL 13

* ORM: SQLAlchemy 2.0.40

* Контейнеризация: Docker + docker-compose
